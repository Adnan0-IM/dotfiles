# Enable True color support
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Allow passthrough of escape sequences
set -gq allow-passthrough on

# Kill unnamed session
set -s destroy-unattached on
# 
set -g default-command "${SHELL} -l"

# Configure window and pane indexing to start at 1
set -g base-index 1
set -g pane-base-index 1

# Source tmux Config if it exists
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Tmux config reloaded!"

# Unbind the default prefix (Ctrl-b)
unbind C-b

# Set the new prefix to backtick
set -g prefix `

# Bind the backtick key to send the prefix itself (allowing you to type it)
bind ` send-prefix

# Renumber windows automatically when one is closed
set-option -g renumber-windows on

# Mouse support
set-option -g mouse on

# Scrollback history limit
set-option -g history-limit 10000


# Create a new window in the current directory
bind c new-window -c "#{pane_current_path}"

# Split panes while retaining the current directory
unbind %
bind = split-window -h -c "#{pane_current_path}"

unbind '"'
bind - split-window -v -c "#{pane_current_path}"


# Enable focus events
set-option -s focus-events on

# Enable extended keys
set-option -s extended-keys on

# Enable immediate response to escape sequences
set-option -s escape-time 0

# Status bar configuration
set-option -g status-position top


unbind v
bind v copy-mode

# resizing panes with hjkl
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5

# maximize panes
bind -r m resize-pane -Z

# vim shell navigations and selects in tmux panes
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'y' send -X copy-selection

# Paste in normal mode
bind p paste-buffer

# Paste inside copy-mode-vi with P (optional)
bind-key -T copy-mode-vi 'P' paste-buffer


set -g popup-style 'bg=default,fg=#cdd6f4'

# Instant switch to a new tmux session directory that exist
bind-key -r f run-shell "tmux neww ~/.config/tmux/scripts/tmux-sessionizer"
bind-key n command-prompt "new-session -s '%%'"
bind-key C-y display-popup -d "#{pane_current_path}" -w 90% -h 90% -E "yazi" # yazi float
bind-key C-t display-popup -d "#{pane_current_path}" -w 80% -h 80% -E "zsh" # quick floating terminal
bind-key C-g display-popup -d "#{pane-current-path}" -w 90% -h 90% -E "lazygit" # lazygit float
bind-key C-m display-popup -w 95% -h 95% -E "rmpc" # music float
bind d display-menu -T "#[align=centre]Config" -x C -y C \
    ".zshrc"            z  "display-popup -w 75% -h 75% -E 'nvim ~/.config/zshrc/custom'" \
    ".zprofile"         p  "display-popup -w 75% -h 75% -E 'nvim ~/.zprofile'" \
    ".tmux.conf"        t  "display-popup -w 75% -h 75% -E 'nvim ~/.config/tmux/tmux.conf'" \
    ".nvim"             v  "display-popup -d "~/dotfiles/nvim/.config/nvim" -w 75% -h 75% -E 'nvim ~/dotfiles/nvim/.config/nvim'" \
    "quit"              q  ""

# Drag copy using mouse
unbind -T copy-mode-vi MouseDragEnd1Pane

# tmux plugin manager 
set-environment -g TMUX_PLUGIN_MANAGER_PATH ~/.config/tmux/.tmux/plugins
set -g @plugin 'tmux-plugins/tpm' # must be the first plugin
set -g @plugin "christoomey/vim-tmux-navigator"

set -g @plugin 'omerxx/tmux-sessionx' # default keybind "<prefix> O" to activate
set -g @plugin "tmux-plugins/tmux-resurrect" #persist tmux sessions after computer restart
set -g @plugin "tmux-plugins/tmux-continuum" #automatically save sessions every 15mins

set -g @plugin 'catppuccin/tmux'
set -g @plugin 'tmux-plugins/tmux-online-status'
set -g @plugin 'tmux-plugins/tmux-battery'

set -g @sessionx-bind 'o'
set -g @resurrect-capture-pane-contents "on"
set -g @continuum-restore "on"

#Configure the catppuccin plugin
set -g @catppuccin_flavor "mocha"


#Left Status

set -g status-left-length 100
set -g status-left "#{E:@catppuccin_status_session}"

#Right
set -g status-right-length 100
set -g status-right "#{E:@catppuccin_status_directory}"
set -ag status-right "#{E:@catppuccin_status_uptime}"
# set -ag status-right "#{E:@catppuccin_status_date_time}"


#Panes setting
set -g @catppuccin_pane_status_enabled "yes" # set to "yes" to enable
set -g @catppuccin_pane_border_status "yes" # set to "yes" to enable
set -g @catppuccin_pane_border_style "fg=#{@thm_overlay_0}"
set -g @catppuccin_pane_active_border_style "##{?pane_in_mode,fg=#{@thm_lavender},##{?pane_synchronized,fg=#{@thm_mauve},fg=#{@thm_lavender}}}"
set -g @catppuccin_pane_left_separator "█"
set -g @catppuccin_pane_middle_separator "█"
set -g @catppuccin_pane_right_separator "█"
set -g @catppuccin_pane_color "#{@thm_green}"
set -g @catppuccin_pane_background_color "#{@thm_surface_0}"
set -g @catppuccin_pane_default_text "##{b:pane_current_path}"
set -g @catppuccin_pane_default_fill "number"
set -g @catppuccin_pane_number_position "left" # right, left

#Windows
set -g @catppuccin_window_status_style "custom" # basic, rounded, slanted, custom, or none
set -g @catppuccin_window_text_color "#{@thm_surface_0}"
set -g @catppuccin_window_number_color "#{@thm_overlay_2}"
set -g @catppuccin_window_text " #W "
set -g @catppuccin_window_number "#I "
set -g @catppuccin_window_current_text_color "#{@thm_surface_1}"
set -g @catppuccin_window_current_number_color "#{@thm_mauve}"
set -g @catppuccin_window_current_text " #W "
set -g @catppuccin_window_current_number "#I "
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_flags "icon" # none, icon, or text
set -g @catppuccin_window_flags_icon_last " " # -
set -g @catppuccin_window_flags_icon_current " " # *
set -g @catppuccin_window_flags_icon_zoom " " # Z
set -g @catppuccin_window_flags_icon_mark " " # M
set -g @catppuccin_window_flags_icon_silent " " # ~
set -g @catppuccin_window_flags_icon_activity " " # #
set -g @catppuccin_window_flags_icon_bell " " # !
#Matches icon order when using `#F` (`#!~[*-]MZ`)
set -g @catppuccin_window_flags_icon_format "##{?window_activity_flag,#{E:@catppuccin_window_flags_icon_activity},}##{?window_bell_flag,#{E:@catppuccin_window_flags_icon_bell},}##{?window_silence_flag,#{E:@catppuccin_window_flags_icon_silent},}##{?window_active,#{E:@catppuccin_window_flags_icon_current},}##{?window_last_flag,#{E:@catppuccin_window_flags_icon_last},}##{?window_marked_flag,#{E:@catppuccin_window_flags_icon_mark},}##{?window_zoomed_flag,#{E:@catppuccin_window_flags_icon_zoom},} "

#Status
set -g @catppuccin_status_background 'none'
set -g @catppuccin_status_left_separator " "
set -g @catppuccin_status_middle_separator ""
set -g @catppuccin_status_right_separator " "
set -g @catppuccin_status_connect_separator "no" # yes, no
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_module_bg_color "#{@thm_surface_0}"


run '~/.config/tmux/.tmux/plugins/tpm/tpm' # always keep this line last
